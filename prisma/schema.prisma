generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  // Uses connection pooling
  url       = env("POSTGRES_PRISMA_URL")
  // Uses direct connection, ⚠️ make sure to keep this to `POSTGRES_URL_NON_POOLING`
  // or you'll have dangling databases from migrations
  directUrl = env("POSTGRES_URL_NON_POOLING")
}



model User {
  id            String   @id @default(cuid())
  name          String   @unique
  email         String   @unique
  password      String
  role          String   @default("USER")
  created_at    DateTime @default(now())
  cart          Cart?
  address       Address?
  first_name    String?
  middle_name   String?
  last_name     String?
  date_of_birth String?
  phone_number  String?
}

model Image {
  id         String  @id @default(cuid())
  url        String  @unique
  product    Product @relation(fields: [product_id], references: [id])
  product_id String
}

model Category {
  id          String            @id @default(cuid())
  name        String            @unique
  description String?
  products    ProductCategory[]
  image       String?
}

model Product {
  id                String            @id @default(cuid())
  name              String            @unique
  description       String
  discount          Int?
  aditional_details String?
  images            Image[]
  colors            Color[]
  price             Int
  itemsLeft         Int?
  categories        ProductCategory[]
  cartProducts      CartProduct[]
}

model Color {
  id         String  @id @default(cuid())
  name       String
  code       String  @unique
  product    Product? @relation(fields: [product_id], references: [id])
  product_id String
}

model ProductCategory {
  product_id  String
  category_id String
  product     Product  @relation(fields: [product_id], references: [id])
  category    Category @relation(fields: [category_id], references: [id])

  @@id([product_id, category_id])
}

model Cart {
  id       String        @id @default(cuid())
  products CartProduct[]
  userId   String        @unique
  user     User          @relation(fields: [userId], references: [id])
}

model CartProduct {
  cartId    String
  productId String
  quantity  Int

  cart    Cart    @relation(fields: [cartId], references: [id])
  product Product @relation(fields: [productId], references: [id])

  @@id([cartId, productId])
}

model Address {
  id           String  @id @default(cuid())
  user         User    @relation(fields: [UserId], references: [id])
  UserId       String  @unique
  address_line String
  house_number String
  floor        String?
  apartment    String?
  neighborhood String?
  country      String  @default("Argentina")
  province     String
  city         String
  postal_code  String
}
