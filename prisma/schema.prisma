generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  // Uses connection pooling
  url       = env("POSTGRES_PRISMA_URL")
  // Uses direct connection, ⚠️ make sure to keep this to `POSTGRES_URL_NON_POOLING`
  // or you'll have dangling databases from migrations
  directUrl = env("POSTGRES_URL_NON_POOLING")
}

model User {
  id            Int      @id @default(autoincrement())
  name          String   @unique
  email         String   @unique
  password      String
  created_at    DateTime @default(now())
  cart          Cart?
  address       Address?
  first_name    String?
  middle_name   String?
  last_name     String?
  date_of_birth String?
  phone_number  String?
}

model Image {
  id         Int     @id @default(autoincrement())
  url        String  @unique
  product    Product @relation(fields: [product_id], references: [id])
  product_id Int
}

model Category {
  id          Int               @id @default(autoincrement())
  name        String            @unique
  description String?
  products    ProductCategory[]
}

model Product {
  id           Int               @id @default(autoincrement())
  name         String            @unique
  description  String
  images       Image[]
  colors       String?
  price        Float
  itemsLeft    Int?
  categories   ProductCategory[]
  cartProducts CartProduct[]
}

model ProductCategory {
  product_id  Int
  category_id Int
  product     Product  @relation(fields: [product_id], references: [id])
  category    Category @relation(fields: [category_id], references: [id])

  @@id([product_id, category_id])
}

model Cart {
  id          Int           @id @default(autoincrement())
  products    CartProduct[]
  description String
  userId      Int           @unique
  user        User          @relation(fields: [userId], references: [id])
}

model CartProduct {
  cartId    Int
  productId Int
  quantity  Int

  cart    Cart    @relation(fields: [cartId], references: [id])
  product Product @relation(fields: [productId], references: [id])

  @@id([cartId, productId])
}

model Address {
  id           Int     @id @default(autoincrement())
  user         User    @relation(fields: [UserId], references: [id])
  UserId       Int     @unique
  address_line String
  house_number String
  floor        String?
  apartment    String?
  neighborhood String?
  country      String  @default("Argentina")
  province     String
  city         String
  postal_code  String
}
